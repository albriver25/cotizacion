<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotización - Seguentech</title>
    <meta name="description" content="Cotización personalizada para equipos tecnológicos. ¡Garantía y soporte técnico incluido!">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 90%;
            max-width: 800px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header img {
            width: 100px;
            height: auto;
        }
        .company-details {
            margin-left: 20px;
        }
        .header-info {
            text-align: right;
        }
        .client-info {
            margin-bottom: 20px;
        }
        .client-info input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        .legend {
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table th, table td {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        table th {
            background: rgba(255, 255, 255, 0.1);
        }
        table td {
            background: rgba(255, 255, 255, 0.05);
        }
        table select, table input, table textarea {
            width: 100%;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #FFFFFF;
        }
        table textarea {
            height: auto; /* Ajuste automático de altura */
            min-height: 30px; /* Altura mínima */
            resize: vertical; /* Permite ajustar verticalmente */
            color: white; /* Texto en blanco */
        }
        table textarea::placeholder {
            color: white; /* Placeholder en blanco */
            opacity: 0.7; /* Opacidad del placeholder */
        }
        .advantages {
            margin-bottom: 20px;
        }
        .footer {
            margin-top: 20px;
        }
        .footer .total-final {
            font-size: 1.2em;
            font-weight: bold;
        }
        .footer .divider {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 10px 0;
        }
        .signature {
            margin-top: 20px;
        }
        .signature p {
            margin: 5px 0;
        }
        button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background: #2a5298;
            color: #fff;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1e3c72;
        }
        #imagenesResultado {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        #imagenesResultado img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
        }
        #descripcionVentajas {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <img src="https://seguen.tech/wp-content/uploads/2024/11/logo_pagina_oficial_letra_s-removebg-preview.png" alt="Logo de Seguentech">
                <div class="company-details">
                    <p><strong>NIT:</strong> 79 547665-3</p>
                    <p><strong>Dirección:</strong> Carrera 16 Número 79-20</p>
                    <p><strong>Teléfono:</strong> 315-585-2297</p>
                </div>
            </div>
            <div class="header-info">
                <p id="fecha">29 de enero de 2025</p>
                <h2>Cotización N° <input type="text" id="quoteNumber" value="SEG0023" readonly=""></h2>
                <p>Asunto: <input type="text" id="quoteSubject" value="Cotizar sistema de talanquera automática" readonly=""></p>
            </div>
        </div>

        <div class="client-info">
            <input type="text" id="clientName" placeholder="Wendy" value="Wendy">
        </div>

        <div class="legend">
            <p>Es un placer cotizarles el siguiente producto:</p>
        </div>

        <h1>Cotización - Seguentech</h1>

        <img id="productImage" src="" alt="Imagen del producto">
        <textarea id="productDescription1" placeholder="Descripción del producto" oninput="buscarImagenes()">Sistema de talanquera automática con software de reconocimiento de placas, apertura y cierre automático. No incluye instalación.</textarea>

        <div id="imagenesResultado">
            <!-- Las imágenes se generarán automáticamente según la descripción -->
        </div>
        <div id="descripcionVentajas"><p><strong>Ventajas destacadas:</strong> No se encontraron ventajas destacadas.</p></div>

        <table>
            <thead>
                <tr>
                    <th style="width: 5%;">U. Medida</th>
                    <th style="width: 5%;">Cantidad</th>
                    <th style="width: 60%;">Descripción del Producto</th>
                    <th style="width: 20%;">Valor Unitario</th>
                    <th style="width: 10%;">Valor Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <select id="unitMeasure1">
                            <option value="Unidad">Unidad</option>
                            <option value="Equipo Portátil">Equipo Portátil</option>
                            <option value="Computador de Escritorio">Computador de Escritorio</option>
                            <option value="Monitor">Monitor</option>
                            <option value="Licencia de Software">Licencia de Software</option>
                            <option value="Periférico">Periférico</option>
                        </select>
                    </td>
                    <td><input type="number" class="quantity" id="quantity1" value="1" min="0" oninput="updateTotal(1)"></td>
                    <td><textarea id="productDescription1" placeholder="Sistema de talanquera automática" style="height: auto;">Sistema de talanquera automática con software de reconocimiento de placas, apertura y cierre automático. No incluye instalación.</textarea></td>
                    <td><input type="text" id="unitPrice1" value="$6,800,000.00" readonly=""></td>
                    <td id="totalValue1">$6,800,000.00</td>
                </tr>
            </tbody>
        </table>

        <div class="advantages">
            <p><strong>¿Por qué elegirnos?</strong></p>
            <p>Con más de <strong>9 años de experiencia</strong>, en Seguentech nos comprometemos a ofrecerte:</p>
            <ul>
                <li><strong>Garantía en cada producto</strong> que adquieras con nosotros.</li>
                <li><strong>Servicio técnico presencial y en línea</strong> para brindarte soporte cuando lo necesites.</li>
                <li><strong>Asesoramiento especializado</strong> en licencias, modificaciones de equipos y soluciones tecnológicas.</li>
            </ul>
            <p>Gracias por confiar en nosotros. Estamos aquí para acompañarte en cada paso hacia la mejor solución tecnológica.</p>
        </div>

        <div class="footer">
            <p class="total-final">Total Final: $<span id="finalTotal">6,800,000.00</span></p>
            <p>IVA: <input type="number" id="iva" placeholder="0" oninput="updateFinalTotal()">%</p>
            <p>Total con IVA: $<span id="totalWithIVA">6,800,000.00</span></p>
            <div class="divider"></div>
            <p><strong>Ubicación:</strong> Unilago, Bogotá, Colombia</p>
            <p><strong>WhatsApp:</strong> 315-751-3697</p>
            <p><strong>Web:</strong> <a href="http://www.seguen.tech" style="color: #fff; text-decoration: none;">www.seguen.tech</a></p>
            <div class="divider"></div>
            <p>Esta cotización tiene una validez de 10 días calendario.</p>
        </div>

        <div class="signature">
            <p>Firma del Representante de Ventas:</p>
            <p>_________________________</p>
        </div>

        <!-- Botones para guardar y enviar -->
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="guardarCotizacion()">Guardar Cotización</button>
            <button onclick="guardarComoTexto()">Guardar como .txt</button>
            <button onclick="guardarComoHTML()">Guardar como .html</button>
            <button onclick="enviarCotizacion()">Enviar Cotización</button>
        </div>
    </div>

    <script>
        // Clave de API de Bing (reemplaza con tu clave)
        const bingApiKey = '045392bff46d41cebae3a059bba53a42';

        // Función para buscar imágenes y descripción de ventajas
        async function buscarImagenes() {
            const descripcion = document.getElementById('productDescription1').value;
            const url = `https://api.bing.microsoft.com/v7.0/images/search?q=${encodeURIComponent(descripcion)}`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'Ocp-Apim-Subscription-Key': bingApiKey
                    }
                });
                const data = await response.json();

                // Mostrar solo 4 imágenes
                const imagenesResultado = document.getElementById('imagenesResultado');
                imagenesResultado.innerHTML = ''; // Limpiar resultados anteriores

                data.value.slice(0, 4).forEach(imagen => {
                    const img = document.createElement('img');
                    img.src = imagen.thumbnailUrl;
                    img.alt = imagen.name;
                    img.style.width = '100px';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '10px';
                    img.style.cursor = 'pointer';
                    img.addEventListener('click', () => {
                        document.getElementById('productImage').src = imagen.contentUrl;
                    });
                    imagenesResultado.appendChild(img);
                });

                // Mostrar una descripción resumida de las ventajas
                const descripcionVentajas = document.getElementById('descripcionVentajas');
                descripcionVentajas.innerHTML = `<p><strong>Ventajas destacadas:</strong> ${data.relatedSearches?.text || 'No se encontraron ventajas destacadas.'}</p>`;
            } catch (error) {
                console.error('Error al buscar imágenes:', error);
            }
        }

        // Función para formatear números con separador de miles (formato colombiano)
        function formatNumber(number) {
            return new Intl.NumberFormat('es-CO', {
                style: 'decimal',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(number);
        }

        // Función para actualizar el valor total cuando se cambia la cantidad
        function updateTotal(rowNumber) {
            const quantity = document.getElementById(`quantity${rowNumber}`).value;
            const unitPrice = parseFloat(document.getElementById(`unitPrice${rowNumber}`).value.replace(/[^0-9.-]+/g, "")) || 0;
            const total = quantity * unitPrice;
            document.getElementById(`totalValue${rowNumber}`).textContent = `$${formatNumber(total)}`;
            updateFinalTotal();
        }

        // Función para calcular el total con IVA
        function updateFinalTotal() {
            let total = 0;
            for (let i = 1; i <= 1; i++) { // Solo una fila ahora
                const rowTotal = parseFloat(document.getElementById(`totalValue${i}`).textContent.replace(/[^0-9.-]+/g, "")) || 0;
                total += rowTotal;
            }
            document.getElementById('finalTotal').textContent = formatNumber(total);

            const iva = parseFloat(document.getElementById('iva').value) || 0;
            const totalWithIVA = total * (1 + iva / 100);
            document.getElementById('totalWithIVA').textContent = formatNumber(totalWithIVA);
        }

        // Mostrar la fecha actual
        const fechaElement = document.getElementById('fecha');
        const hoy = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        fechaElement.textContent = hoy.toLocaleDateString('es-ES', options);

        // Función para guardar la cotización en el almacenamiento local
        function guardarCotizacion() {
            const cotizacion = {
                cliente: document.getElementById('clientName').value,
                productos: [
                    {
                        descripcion: document.getElementById('productDescription1').value,
                        cantidad: document.getElementById('quantity1').value,
                        precioUnitario: document.getElementById('unitPrice1').value,
                        total: document.getElementById('totalValue1').textContent
                    }
                ],
                totalFinal: document.getElementById('finalTotal').textContent,
                iva: document.getElementById('iva').value,
                totalConIVA: document.getElementById('totalWithIVA').textContent
            };

            // Guardar en localStorage
            localStorage.setItem('ultimaCotizacion', JSON.stringify(cotizacion));
            alert('Cotización guardada correctamente.');
        }

        // Función para guardar la cotización como archivo .txt
        function guardarComoTexto() {
            const cliente = document.getElementById('clientName').value;
            if (!cliente) {
                alert('Por favor, ingresa el nombre del cliente.');
                return;
            }

            // Obtener el contenido HTML completo de la página
            const contenidoHTML = document.documentElement.outerHTML;

            // Crear el contenido del archivo .txt
            let contenido = `Cliente: ${cliente}\n\n`;
            contenido += `Código HTML:\n\n`;
            contenido += contenidoHTML;

            // Crear el archivo .txt y descargarlo
            const blob = new Blob([contenido], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cotizacion_${cliente}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Función para guardar la cotización como archivo .html
        function guardarComoHTML() {
            const cliente = document.getElementById('clientName').value;
            if (!cliente) {
                alert('Por favor, ingresa el nombre del cliente.');
                return;
            }

            // Obtener el contenido HTML completo de la página
            const contenidoHTML = document.documentElement.outerHTML;

            // Crear el archivo .html y descargarlo
            const blob = new Blob([contenidoHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cotizacion_${cliente}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Función para enviar la cotización por correo (simulación)
        function enviarCotizacion() {
            const cotizacion = JSON.parse(localStorage.getItem('ultimaCotizacion'));
            if (cotizacion) {
                alert(`Cotización enviada a ${cotizacion.cliente}.\nTotal: ${cotizacion.totalConIVA}`);
            } else {
                alert('No hay cotización guardada.');
            }
        }

        // Llamar a la función buscarImagenes cada segundo
        setInterval(buscarImagenes, 1000);
    </script>
</body>
</html>